<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>TTS Chat Room</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0f0f0f;
      color: white;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    h2 {
      text-align: center;
      margin: 10px 0;
    }

    #chat {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
    }

    .msg {
      margin-bottom: 6px;
      font-size: 15px;
    }

    #input {
      display: flex;
      border-top: 1px solid #333;
    }

    input {
      flex: 1;
      padding: 12px;
      font-size: 16px;
      border: none;
      outline: none;
    }

    button {
      padding: 12px 18px;
      font-size: 16px;
      background: #5865f2;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background: #4752c4;
    }
  </style>
</head>

<body>
  <h2>ðŸ”Š TTS Chat Room</h2>

  <div id="chat"></div>

  <div id="input">
    <input id="text" placeholder="Type a message..." />
    <button id="send">Send</button>
  </div>

<script type="module">
  // ðŸ”¥ Firebase v9 imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import {
    getDatabase,
    ref,
    push,
    onChildAdded,
    query,
    limitToLast
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  // ðŸ” YOUR FIREBASE CONFIG (unchanged)
  const firebaseConfig = {
    apiKey: "AIzaSyCdlefibbnAvbdZ86lPJAdUtifGPP7uQTE",
    authDomain: "tts-projet-fd867.firebaseapp.com",
    databaseURL: "https://tts-projet-fd867-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "tts-projet-fd867",
    storageBucket: "tts-projet-fd867.firebasestorage.app",
    messagingSenderId: "412421975876",
    appId: "1:412421975876:web:bae419fa68b429ba52f111"
  };

  // ðŸš€ Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const messagesRef = ref(db, "messages");

  // ðŸ” Require username
  let username = "";
  while (!username) {
    username = prompt("Enter your name to join:");
    if (username) username = username.trim();
  }

  const input = document.getElementById("text");
  const chat = document.getElementById("chat");
  const sendBtn = document.getElementById("send");

  // ðŸŽ™ Discord-style browser TTS
  function speak(text) {
    speechSynthesis.cancel();

    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = "en-US";
    msg.rate = 1.25;
    msg.pitch = 1.0;
    msg.volume = 1;

    const voices = speechSynthesis.getVoices();
    for (const v of voices) {
      if (v.lang === "en-US") {
        msg.voice = v;
        break;
      }
    }

    speechSynthesis.speak(msg);
  }

  // ðŸ“¤ Send message
  function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    push(messagesRef, {
      user: username,
      text: text
    });

    input.value = "";
  }

  sendBtn.onclick = sendMessage;

  // âŒ¨ï¸ Enter key support
  input.addEventListener("keydown", e => {
    if (e.key === "Enter") {
      sendMessage();
    }
  });

  // ðŸ“¥ Receive messages
  const messagesQuery = query(messagesRef, limitToLast(100));
  onChildAdded(messagesQuery, snapshot => {
    const data = snapshot.val();

    const div = document.createElement("div");
    div.className = "msg";
    div.textContent = `${data.user}: ${data.text}`;
    chat.appendChild(div);

    chat.scrollTop = chat.scrollHeight;
    speak(data.text);
  });
</script>
</body>
</html>
